<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>{{ w.title }} - {{ site_name }}</title>
  <meta name="description" content="{{ w.description or w.title }}" />
  <link rel="stylesheet" href="{{ css_path }}">

  {% if canonical_url %}<link rel="canonical" href="{{ canonical_url }}" />{% endif %}
  <meta property="og:site_name" content="{{ site_name }}" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="{{ w.title }} - {{ site_name }}" />
  <meta property="og:description" content="{{ w.description or w.title }}" />
  {% if canonical_url %}<meta property="og:url" content="{{ canonical_url }}" />{% endif %}
  {% if w.hero_image %}<meta property="og:image" content="{{ w.hero_image }}" />{% endif %}
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{ w.title }} - {{ site_name }}" />
  <meta name="twitter:description" content="{{ w.description or w.title }}" />
  {% if w.hero_image %}<meta property="og:image" content="{{ w.hero_image }}" />{% endif %}

  <style>
    .media-section{margin-top:14px}
    .media-title{font-weight:900; margin:0 0 10px}
    .video-wrap{
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      background:rgba(0,0,0,.25);
      box-shadow: var(--shadow);
    }
    .video-aspect{position:relative; padding-top:56.25%;}
    .video-aspect iframe{position:absolute; inset:0; width:100%; height:100%; border:0;}
    .gallery{
      display:grid;
      grid-template-columns:repeat(4, minmax(0, 1fr));
      gap:10px;
      margin:10px 0 0;
    }
    @media (max-width: 980px){ .gallery{grid-template-columns:repeat(3,1fr)} }
    @media (max-width: 640px){ .gallery{grid-template-columns:repeat(2,1fr)} }
    .gitem{
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      background:rgba(255,255,255,.04);
      cursor:pointer;
    }
    .gitem img{width:100%; height:100%; aspect-ratio: 3/4; object-fit:cover; display:block;}
    .lightbox{
      position:fixed; inset:0;
      background:rgba(0,0,0,.78);
      display:none; align-items:center; justify-content:center;
      z-index:9999;
      padding:24px;
    }
    .lightbox.open{display:flex;}
    .lightbox-inner{
      max-width: 1100px;
      width: 100%;
      background:rgba(15,23,42,.92);
      border:1px solid var(--line);
      border-radius:18px;
      overflow:hidden;
      box-shadow: var(--shadow);
      position:relative;
    }
    .lightbox-img{width:100%; height:auto; display:block;}
    .lightbox-close{
      position:absolute; top:10px; right:10px;
      width:36px; height:36px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;
      font-size:18px;
      display:flex; align-items:center; justify-content:center;
    }
    .lightbox-close:hover{border-color:rgba(96,165,250,.55)}
  </style>
</head>
<body>
  <header class="header">
    <div class="container header-inner">
      <div class="brand"><a href="{{ home_href }}"><strong>{{ site_name }}</strong></a></div>
      <nav class="nav">
        <a href="{{ home_href }}">ホーム</a>
        <a href="{{ actresses_href }}">女優</a>
        <a href="{{ genres_href }}">ジャンル</a>
        <a href="{{ search_href }}">検索</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>{{ w.title }}</h1>
      <p>公開日：{{ w.release_date }}</p>
    </section>

    <article class="card">
      {% if w.hero_image %}
        <a href="{{ w.hero_image }}" class="hero-link" style="display:block;">
          <img class="thumb" src="{{ w.hero_image }}" alt="{{ w.title }}" loading="lazy">
        </a>
      {% endif %}
      <div class="pad">
        {% if w.description %}
          <div class="small">{{ w.description }}</div>
        {% endif %}

        {% if w.review and (w.review.count or w.review.average) %}
          <div class="small" style="margin-top:10px;">
            レビュー：
            {% if w.review.average %}★{{ w.review.average }}{% endif %}
            {% if w.review.count %}（{{ w.review.count }}件）{% endif %}
          </div>
        {% endif %}

        {% if w.prices and w.prices.price %}
          <div class="small" style="margin-top:6px;">価格：{{ w.prices.price }}</div>
        {% endif %}

        {% if w_actress_items and w_actress_items|length > 0 %}
          <div class="tags" style="margin-top:12px;">
            {% for a in w_actress_items %}
              <a class="tag" href="{{ a.href }}">{{ a.name }}</a>
            {% endfor %}
          </div>
        {% endif %}

        {% if w_tag_items and w_tag_items|length > 0 %}
          <div class="tags" style="margin-top:12px;">
            {% for t in w_tag_items %}
              <a class="tag" href="{{ t.href }}">{{ t.name }}</a>
            {% endfor %}
          </div>
        {% endif %}

        <div class="actions" style="margin-top:14px;">
          <a class="btn secondary" href="{{ home_href }}">一覧へ戻る</a>
          {% set link = w.official_url or w.affiliate_url or w.URL or w.affiliateURL %}
          {% if link %}
            <a class="btn" href="{{ link }}" target="_blank" rel="noopener">公式ページを見る</a>
          {% endif %}
          {% set mv = w.sample_movie or w.sample_movie_url %}
          {% if mv %}{% set mv = mv|replace('http://','https://') %}{% endif %}
          {% if mv %}
            <a class="btn secondary" href="{{ mv }}" target="_blank" rel="noopener">サンプル動画（別タブ）</a>
          {% endif %}
        </div>
      </div>
    </article>

    {# =========================
       サンプル動画（API: sampleMovieURL）
       ========================= #}
    {% set sample_movie = w.sample_movie or w.sample_movie_url %}
    {% if (not sample_movie) and w.sample_movie_urls %}
      {# sample_movie_urls が dict なら優先キーを拾う #}
      {% set sample_movie = w.sample_movie_urls.size_720_480 or w.sample_movie_urls.size_644_414 or w.sample_movie_urls.size_560_360 or w.sample_movie_urls.size_476_306 %}
    {% endif %}

    {% if sample_movie %}
      {% set sample_movie = sample_movie|replace('http://','https://') %}
      <section class="media-section">
        <h2 class="media-title">サンプル動画</h2>
        <div class="video-wrap">
          <div class="video-aspect">
            <iframe src="{{ sample_movie }}" allowfullscreen loading="lazy"></iframe>
          </div>
        </div>
        <div class="small" style="margin-top:8px;">
          ※環境によっては埋め込み再生がブロックされる場合があります。その場合は上の「サンプル動画（別タブ）」をご利用ください。
        </div>
      </section>
    {% endif %}

    {# =========================
       サンプル画像（API: sampleImageURL）
       ========================= #}
    {% set imgs = (w.sample_images or []) %}
    {% if imgs and imgs|length > 0 %}
      <section class="media-section">
        <h2 class="media-title">サンプル画像</h2>
        <div class="gallery" id="gallery">
          {% for u in imgs %}
            <div class="gitem" data-img="{{ u }}">
              <img src="{{ u }}" alt="{{ w.title }} サンプル画像 {{ loop.index }}" loading="lazy">
            </div>
          {% endfor %}
        </div>
      </section>
    {% endif %}

    {% if related_works and related_works|length > 0 %}
      <hr style="margin:18px 0; border:0; border-top:1px solid rgba(255,255,255,.08);">

      <h2 style="margin:0 0 10px;">関連作品（同じ女優）</h2>

      <div class="grid">
        {% for rw in related_works %}
          {% set detail_href = works_prefix ~ rw.id ~ '/' %}
          <div class="card">
            {% if rw.hero_image %}
              <a href="{{ detail_href }}" style="display:block;">
                <img class="thumb" src="{{ rw.hero_image }}" alt="{{ rw.title }}" loading="lazy">
              </a>
            {% endif %}
            <div class="pad">
              <p class="title" style="margin:0 0 6px;">
                <a href="{{ detail_href }}" style="color:inherit; text-decoration:none;">{{ rw.title }}</a>
              </p>
              <div class="meta">公開日：{{ rw.release_date }}</div>

              <div class="actions">
                <a class="btn secondary" href="{{ detail_href }}">詳細を見る</a>
                {% if rw.official_url %}
                  <a class="btn" href="{{ rw.official_url }}" target="_blank" rel="noopener">公式ページを見る</a>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="footer">© 2026 {{ site_name }}</div>
  </main>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="lightbox-inner">
      <button class="lightbox-close" id="lbClose" type="button" aria-label="閉じる">×</button>
      <img class="lightbox-img" id="lbImg" src="" alt="">
    </div>
  </div>

  <script>
    (function(){
      const lb = document.getElementById("lightbox");
      const lbImg = document.getElementById("lbImg");
      const lbClose = document.getElementById("lbClose");

      function openLb(src){
        lbImg.src = src;
        lb.classList.add("open");
        lb.setAttribute("aria-hidden", "false");
      }
      function closeLb(){
        lb.classList.remove("open");
        lb.setAttribute("aria-hidden", "true");
        lbImg.src = "";
      }

      // サンプル画像クリックで拡大
      const g = document.getElementById("gallery");
      if (g){
        g.addEventListener("click", (e) => {
          const t = e.target.closest(".gitem");
          if (!t) return;
          const src = t.getAttribute("data-img");
          if (src) openLb(src);
        });
      }

      // メイン画像クリックでも拡大（リンク）
      const hero = document.querySelector(".hero-link");
      if (hero){
        hero.addEventListener("click", (e) => {
          e.preventDefault();
          const href = hero.getAttribute("href");
          if (href) openLb(href);
        });
      }

      lb.addEventListener("click", (e) => {
        if (e.target === lb) closeLb();
      });
      lbClose.addEventListener("click", closeLb);
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeLb();
      });
    })();
  </script>
</body>
</html>
