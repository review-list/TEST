{% extends "_base.html" %}
{% block content %}
<section class="container">
  <div class="page-head">
    <h1 class="page-title">{{ heading }}</h1>

    {% if sort_tabs %}
      <div class="sort-tabs" role="navigation" aria-label="ä¸¦ã³æ›¿ãˆ">
        {% for t in sort_tabs %}
          <a class="sort-tab{% if sort_id == t.id %} is-active{% endif %}" href="{{ root_path }}{{ t.href }}">{{ t.label }}</a>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  {% if show_personal_sections %}
  <div class="personal-wrap" id="personalWrap" hidden>
    <div class="personal-block" id="recentBlock" hidden>
      <div class="personal-head">
        <h2 class="personal-title">æœ€è¿‘è¦‹ãŸ</h2>
        <button class="btn btn-ghost btn-sm" id="recentClear" type="button">ã‚¯ãƒªã‚¢</button>
      </div>
      <div id="recentGrid" class="works-grid"></div>
    </div>

    <div class="personal-block" id="favBlock" hidden>
      <div class="personal-head">
        <h2 class="personal-title">ãŠæ°—ã«å…¥ã‚Š</h2>
        <button class="btn btn-ghost btn-sm" id="favClear" type="button">ã‚¯ãƒªã‚¢</button>
      </div>
      <div id="favGrid" class="works-grid"></div>
    </div>
  </div>
  {% endif %}

  {% if pager and pager.page %}
  <div class="pager">
    {% if pager.prev is not none %}
      <a class="btn btn-ghost" href="{{ root_path }}{{ pager.prev }}">â† å‰</a>
    {% else %}
      <span class="btn btn-ghost is-disabled">â† å‰</span>
    {% endif %}

    <span class="pager-text">{{ pager.page }} / {{ pager.total }}</span>

    {% if pager.next is not none %}
      <a class="btn btn-ghost" href="{{ root_path }}{{ pager.next }}">æ¬¡ â†’</a>
    {% else %}
      <span class="btn btn-ghost is-disabled">æ¬¡ â†’</span>
    {% endif %}
  </div>
  {% endif %}

  <div class="works-grid">
    {% for w in works %}
      <a class="work-card" href="{{ root_path }}works/{{ w.id }}/" aria-label="{{ w.title }}">
        <div class="work-thumb">
          <button class="fav-btn" type="button" aria-label="ãŠæ°—ã«å…¥ã‚Š" aria-pressed="false"
            data-work-id="{{ w.id }}"
            data-work-title="{{ (w.title or '')|e }}"
            data-work-hero="{{ (w.hero_image or '')|e }}"
            data-work-path="works/{{ w.id }}/"
            data-work-maker="{{ (w.maker or '')|e }}"
            data-work-release="{{ ((w.release_date or '')|replace(' 00:00:00',''))|e }}"
            data-has-img="{{ 1 if w._has_img else 0 }}"
            data-has-mov="{{ 1 if w._has_mov else 0 }}"
          >â˜†</button>
          {% if w.hero_image %}
            <img loading="lazy" src="{{ w.hero_image }}" alt="{{ w.title }}">
          {% else %}
            <div class="thumb-placeholder"></div>
          {% endif %}
          {% if sort_id == "rank" and (w.api_rank or w._tmp_rank) %}
            <div class="work-rank">
              <span class="badge badge-rank">{{ w.api_rank or w._tmp_rank }}ä½</span>
            </div>
          {% endif %}
          <div class="work-badges">
            {% if w._has_img %}
              <span class="badge badge-img">ğŸ–¼ï¸ ã‚µãƒ³ãƒ—ãƒ«ç”»åƒã‚ã‚Š</span>
            {% endif %}
            {% if w._has_mov %}
              <span class="badge badge-mov">ğŸ¬ ã‚µãƒ³ãƒ—ãƒ«å‹•ç”»ã‚ã‚Š</span>
            {% endif %}
          </div>
        </div>

        <div class="work-meta">
          <div class="work-title">{{ w.title }}</div>
          <div class="work-sub">
            {% if w.release_date %}<span class="muted">{{ w.release_date }}</span>{% endif %}
            {% if w.maker %}<span class="dot">â€¢</span><span class="muted">{{ w.maker }}</span>{% endif %}
            {% if w.series %}<span class="dot">â€¢</span><span class="muted">{{ w.series }}</span>{% endif %}
          </div>
        </div>
      </a>
    {% endfor %}
  </div>

  {% if pager and pager.page %}
  <div class="pager pager--bottom">
    {% if pager.prev is not none %}
      <a class="btn btn-ghost" href="{{ root_path }}{{ pager.prev }}">â† å‰</a>
    {% else %}
      <span class="btn btn-ghost is-disabled">â† å‰</span>
    {% endif %}

    <span class="pager-text">{{ pager.page }} / {{ pager.total }}</span>

    {% if pager.next is not none %}
      <a class="btn btn-ghost" href="{{ root_path }}{{ pager.next }}">æ¬¡ â†’</a>
    {% else %}
      <span class="btn btn-ghost is-disabled">æ¬¡ â†’</span>
    {% endif %}
  </div>
  {% endif %}
</section>
{% endblock %}
