<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>{% if page_title %}{{ page_title }} - {{ site_name }}{% else %}{{ site_name }}{% endif %}</title>
  <meta name="description" content="{{ page_description or (site_name ~ ' ã®ä½œå“ä¸€è¦§ã§ã™ã€‚') }}" />

  {% if css_path %}
    <link rel="stylesheet" href="{{ css_path }}">
  {% endif %}

  <style>
    /* ãƒ•ã‚£ãƒ«ã‚¿UIï¼ˆå…±é€šCSSã®ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã«åˆã‚ã›ã‚‹ï¼‰ */
    .controls{margin:14px 0 18px; display:grid; gap:10px;}
    .controls .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .controls input[type="search"], .controls select{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      min-width:220px;
      outline:none;
    }
    .controls input[type="search"]::placeholder{color:rgba(148,163,184,.9)}
    .controls button{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      cursor:pointer;
      font-weight:800;
    }
    .controls button:hover{border-color:rgba(96,165,250,.55)}
    .controls select option, .controls select optgroup{
      background:#0b1220;
      color:var(--text);
    }
    .count{color:var(--muted); font-size:14px; margin-left:auto;}
    .is-hidden{ display:none !important; }
  </style>

  {% if canonical_url %}<link rel="canonical" href="{{ canonical_url }}" />{% endif %}
  <meta property="og:site_name" content="{{ site_name }}" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="{% if page_title %}{{ page_title }} - {{ site_name }}{% else %}{{ site_name }}{% endif %}" />
  <meta property="og:description" content="{{ page_description or (site_name ~ ' ã®ä½œå“ä¸€è¦§ã§ã™ã€‚') }}" />
  {% if canonical_url %}<meta property="og:url" content="{{ canonical_url }}" />{% endif %}
  {% if (works[0].hero_image if works and works|length>0 else None) %}<meta property="og:image" content="{{ (works[0].hero_image if works and works|length>0 else None) }}" />{% endif %}
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{% if page_title %}{{ page_title }} - {{ site_name }}{% else %}{{ site_name }}{% endif %}" />
  <meta name="twitter:description" content="{{ page_description or (site_name ~ ' ã®ä½œå“ä¸€è¦§ã§ã™ã€‚') }}" />
  {% if (works[0].hero_image if works and works|length>0 else None) %}<meta property="og:image" content="{{ (works[0].hero_image if works and works|length>0 else None) }}" />{% endif %}
</head>

<body>
  <!-- å…±é€šCSSï¼ˆ.header/.header-inner/.navï¼‰ã«çµ±ä¸€ -->
  <header class="header">
    <div class="container header-inner">
      <div class="brand">
        <a href="{{ home_href or './' }}"><strong>{{ site_name }}</strong></a>
      </div>
      <nav class="nav">
        <a href="{{ home_href or './' }}">ãƒ›ãƒ¼ãƒ </a>
        <a href="{{ actresses_href or 'actresses/' }}">å¥³å„ª</a>
        <a href="{{ genres_href or 'genres/' }}">ã‚¸ãƒ£ãƒ³ãƒ«</a>
        <a href="{{ search_href or 'search/' }}">æ¤œç´¢</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>{% if page_title %}{{ page_title }}{% else %}ä½œå“ä¸€è¦§{% endif %}</h1>
      <p>{% if page_description %}{{ page_description }}{% else %}{{ site_name }} ã®ä½œå“ä¸€è¦§ã§ã™ã€‚{% endif %}</p>
    </section>

    {# âœ… ãƒˆãƒƒãƒ—ã ã‘ã«ã€Œãƒšãƒ¼ã‚¸ãƒ³ã‚°ä¸€è¦§ã€ã¸ã®å°ã•ã„å°ç·šã‚’ç½®ã #}
    {% if not page_title %}
      <div style="margin:-6px 0 12px;">
        <a href="{{ pages_href }}" style="font-size:13px; color:var(--muted); text-decoration:none;">
          ä½œå“ä¸€è¦§ï¼ˆãƒšãƒ¼ã‚¸ãƒ³ã‚°ï¼‰ã‚’è¦‹ã‚‹ â†’
        </a>
      </div>
    {% endif %}

    <!-- âœ… æ¤œç´¢ï¼†çµã‚Šè¾¼ã¿ï¼ˆãƒšãƒ¼ã‚¸å†…ãƒ•ã‚£ãƒ«ã‚¿ï¼‰ -->
    <section class="controls" aria-label="æ¤œç´¢ã¨çµã‚Šè¾¼ã¿">
      <div class="row">
        <input id="q" type="search" placeholder="ã‚¿ã‚¤ãƒˆãƒ« / å¥³å„ª / ã‚¿ã‚°ã§æ¤œç´¢" autocomplete="off">
        <select id="actress">
          <option value="">å¥³å„ªï¼ˆã™ã¹ã¦ï¼‰</option>
          {% for a in (actresses_keys or []) %}
            <option value="{{ a }}">{{ a }}</option>
          {% endfor %}
        </select>
        <select id="tag">
          <option value="">ã‚¿ã‚°ï¼ˆã™ã¹ã¦ï¼‰</option>
          {% for g in (genres_keys or []) %}
            <option value="{{ g }}">{{ g }}</option>
          {% endfor %}
        </select>
        <button id="reset" type="button">ãƒªã‚»ãƒƒãƒˆ</button>

        <div class="count">
          <span id="shown">0</span> / <span id="total">0</span> ä»¶
        </div>
      </div>
    </section>

    <!-- âœ… ä¸€è¦§ -->
    <section class="grid" id="works">
      {% for w in works %}
        {% set actress_text = (w.actresses or []) | join(' ') %}
        {% set tag_text = (w.tags or []) | join(' ') %}
        {% set detail_href = works_prefix ~ w.id ~ '/' %}

        <article class="card work-item"
          data-title="{{ (w.title or '') | lower }}"
          data-actresses="{{ actress_text | lower }}"
          data-tags="{{ tag_text | lower }}"
        >
          {% if w.hero_image %}
            <a href="{{ detail_href }}" style="display:block;">
              <img class="thumb" src="{{ w.hero_image }}" alt="{{ w.title }}" loading="lazy">
            </a>
          {% endif %}

          <div class="pad">
            <p class="title" style="margin:0 0 6px;">
              <a href="{{ detail_href }}" style="color:inherit; text-decoration:none;">
                {{ w.title }}
              </a>
            </p>

            {% if w.release_date %}
              <div class="meta">å…¬é–‹æ—¥ï¼š{{ w.release_date }}</div>
            {% endif %}

            {% if w.actresses %}
              <div class="tags" style="margin-top:10px;">
                {% for a in w.actresses %}
                  <span class="tag">{{ a }}</span>
                {% endfor %}
              </div>
            {% endif %}

            {% if w.tags %}
              <div class="tags" style="margin-top:10px;">
                {% for t in w.tags[:8] %}
                  <span class="tag">{{ t }}</span>
                {% endfor %}
              </div>
            {% endif %}

	            {# ã‚µãƒ³ãƒ—ãƒ«æœ‰ç„¡ï¼ˆä¸€è¦§ã§ã‚‚åˆ†ã‹ã‚‹ã‚ˆã†ã«ï¼‰ #}
	            {% set si = (w.sample_images|length) if w.sample_images else 0 %}
	            {% set mv = w.sample_movie or w.sample_movie_url %}
	            {% if (not mv) and w.sample_movie_urls %}
	              {% set mv = w.sample_movie_urls.size_720_480 or w.sample_movie_urls.size_644_414 or w.sample_movie_urls.size_560_360 or w.sample_movie_urls.size_476_306 %}
	            {% endif %}
	            {% if (si and si > 0) or mv %}
	              <div class="badges" style="margin-top:10px;">
	                {% if si and si > 0 %}<span class="badge sm on" title="ã‚µãƒ³ãƒ—ãƒ«ç”»åƒã‚ã‚Š">ğŸ–¼ï¸ ã‚µãƒ³ãƒ—ãƒ«ç”»åƒã‚ã‚Š</span>{% endif %}
	                {% if mv %}<span class="badge sm on" title="ã‚µãƒ³ãƒ—ãƒ«å‹•ç”»ã‚ã‚Š">ğŸ¬ ã‚µãƒ³ãƒ—ãƒ«å‹•ç”»ã‚ã‚Š</span>{% endif %}
	              </div>
	            {% endif %}

            <div class="actions">
              <a class="btn secondary" href="{{ detail_href }}">è©³ç´°ã‚’è¦‹ã‚‹</a>
              {% if w.official_url %}
                <a class="btn" href="{{ w.official_url }}" target="_blank" rel="noopener">å…¬å¼ãƒšãƒ¼ã‚¸ã‚’è¦‹ã‚‹</a>
              {% endif %}
            </div>
          </div>
        </article>
      {% endfor %}
    </section>

    {% if total_pages and total_pages > 1 and page %}
      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin: 8px 0 26px;">
        {% if page > 1 %}
          <a class="btn secondary" href="{{ '../' if page == 2 else ('../' ~ (page-1) ~ '/') }}">å‰ã¸</a>
        {% endif %}
        <span class="small" style="align-self:center;">{{ page }} / {{ total_pages }}</span>
        {% if page < total_pages %}
          <a class="btn secondary" href="{{ '../' ~ (page+1) ~ '/' }}">æ¬¡ã¸</a>
        {% endif %}
      </div>
    {% endif %}

    <div class="footer">Â© 2026 {{ site_name }}</div>
  </main>

  <script>
    (function(){
      const q = document.getElementById("q");
      const actress = document.getElementById("actress");
      const tag = document.getElementById("tag");
      const reset = document.getElementById("reset");

      const items = Array.from(document.querySelectorAll(".work-item"));
      const shownEl = document.getElementById("shown");
      const totalEl = document.getElementById("total");

      totalEl.textContent = String(items.length);

      function norm(s){ return (s || "").toString().trim().toLowerCase(); }

      function apply(){
        const kw = norm(q.value);
        const a = norm(actress.value);
        const t = norm(tag.value);

        let shown = 0;
        for (const el of items){
          const title = el.dataset.title || "";
          const as = el.dataset.actresses || "";
          const tags = el.dataset.tags || "";

          const okKw = !kw || (title.includes(kw) || as.includes(kw) || tags.includes(kw));
          const okA  = !a  || as.includes(a);
          const okT  = !t  || tags.includes(t);

          const ok = okKw && okA && okT;
          el.classList.toggle("is-hidden", !ok);
          if (ok) shown++;
        }
        shownEl.textContent = String(shown);
      }

      q.addEventListener("input", apply);
      actress.addEventListener("change", apply);
      tag.addEventListener("change", apply);
      reset.addEventListener("click", function(){
        q.value = "";
        actress.value = "";
        tag.value = "";
        apply();
        q.focus();
      });

      apply();
    })();
  </script>
</body>
</html>
